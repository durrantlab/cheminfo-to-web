var demoMolData = {
	"benzene" : "unnamed\n  Kekule  04101518572D\n\n  6  6  0  0  0  0  0  0  0  0999 V2000\n   10.9222   36.5707    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.9222   35.7707    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.2293   36.9707    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.2293   35.3707    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    9.5365   36.5707    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    9.5365   35.7707    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  1  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  3  5  2  0  0  0  0\n  4  6  2  0  0  0  0\n  5  6  1  0  0  0  0\nM  END",
	"pyrrole": "Untitled Document-2\n  Kekule  10201418212D\n\n  5  5  0  0  0  0  0  0  0  0999 V2000\n    0.0000   -0.6348    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6674   -0.1498    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6674   -0.1498    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.4125    0.6348    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.4125    0.6348    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  4  2  0  0  0  0\n  3  5  2  0  0  0  0\n  4  5  1  0  0  0  0\nM  END",
	"furan": "furan.mol\n  ChemDraw05101518552D\n\n  5  5  0  0  0  0  0  0  0  0999 V2000\n    0.0000    0.6348    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6674    0.1498    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6674    0.1498    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.4125   -0.6348    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.4125   -0.6348    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  4  2  0  0  0  0\n  3  5  2  0  0  0  0\n  4  5  1  0  0  0  0\nM  END",
	"caffeine": "caffeine.mol\n  ChemDraw05101518502D\n\n 14 15  0  0  0  0  0  0  0  0999 V2000\n    0.4407    0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.4407   -0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.2737    0.8250    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2214    0.6639    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.2737   -0.8250    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2214   -0.6639    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.9884    0.4125    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.2737    1.6500    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.7028    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4776    1.4482    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.9884   -0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.2737   -1.6500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.7028    0.8250    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.7028   -0.8250    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  6  1  0  0  0  0\n  3  7  1  0  0  0  0\n  3  8  2  0  0  0  0\n  4  9  1  0  0  0  0\n  4 10  1  0  0  0  0\n  5 11  1  0  0  0  0\n  5 12  1  0  0  0  0\n  6  9  2  0  0  0  0\n  7 11  1  0  0  0  0\n  7 13  1  0  0  0  0\n 11 14  2  0  0  0  0\nM  END",
	"mannitol": "mannitol.mol\n  ChemDraw05101518522D\n\n 12 11  0  0  0  0  0  0  0  0999 V2000\n    0.3572    0.2063    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.3572   -0.2063    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.0718   -0.2063    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.3572    1.0313    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.0718    0.2063    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.3572   -1.0313    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.7861    0.2063    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.0718   -1.0313    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.7861   -0.2063    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.0718    1.0313    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5007   -0.2063    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.5007    0.2063    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  6  0  0  0\n  2  5  1  0  0  0  0\n  2  6  1  6  0  0  0\n  3  7  1  0  0  0  0\n  3  8  1  1  0  0  0\n  5  9  1  0  0  0  0\n  5 10  1  1  0  0  0\n  7 11  1  0  0  0  0\n  9 12  1  0  0  0  0\nM  END",
	"morphine": "morphine.mol\n  ChemDraw05101518542D\n\n 21 25  0  0  0  0  0  0  0  0999 V2000\n   -0.6343   -0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6343    0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0801   -0.8250    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3487   -0.8250    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1576    0.1925    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3487    0.8250    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0801    0.8250    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.7946   -0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0801   -1.6500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.8992    0.0458    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3487   -1.6500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.0157    0.1925    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3487    1.6500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.7946    0.4125    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0801    1.6500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5091   -0.8250    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6343   -2.0625    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0999   -2.0836    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6343    2.0625    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0999    2.0836    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0999   -1.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  1  5  1  1  0  0  0\n  2  6  1  0  0  0  0\n  2  7  2  0  0  0  0\n  3  8  1  0  0  0  0\n  3  9  1  0  0  0  0\n  4 10  1  0  0  0  0\n  4 11  1  0  0  0  0\n  5 12  1  0  0  0  0\n  6 10  1  0  0  0  0\n  6 13  2  0  0  0  0\n  7 14  1  0  0  0  0\n  7 15  1  0  0  0  0\n  8 14  1  0  0  0  0\n  8 16  1  0  0  0  0\n  9 17  2  0  0  0  0\n 11 17  1  0  0  0  0\n 11 18  1  6  0  0  0\n 12 16  1  0  0  0  0\n 13 19  1  0  0  0  0\n 13 20  1  0  0  0  0\n 15 19  2  0  0  0  0\n 16 21  1  0  0  0  0\nM  END"
};
var demoSmilesData = {
	"benzene": "c1ccccc1",
	"pyrrole": "c1c[nH]cc1",
	"furan": "c1cocc1",
	"caffeine": "O=c1n(C)c2c(n(cn2)C)c(=O)n1C",
	"mannitol": "OC[C@@H](O)[C@@H](O)[C@H](O)[C@H](O)CO"
	//"morphine": "CN1C2C3[C@@]4(CC1)c5c(c(ccc5C2)O)OC4[C@@H](O)C=C3"
};
var demoTautomerSrcMolData = {
	"pyrazole": "unnamed\n  -INDIGO-04111722232D\n\n  5  5  0  0  0  0  0  0  0  0999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2944   -0.9405    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.8000   -2.4621    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.8000   -2.4621    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2944   -0.9405    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\nM  END"
};
demoTautomerSrcMolData["purin-6-ol"] = "unnamed\n  -INDIGO-04111722282D\n\n 10 11  0  0  0  0  0  0  0  0999 V2000\n    2.4000    1.3856    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.6000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.8000   -1.3856    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.3650   -1.0530    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.5323    0.5383    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.0706    1.1890    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000   -2.7713    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.6000   -2.7713    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4000   -1.3856    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  7  3  1  0  0  0  0\n  4  8  2  0  0  0  0\n  8  9  1  0  0  0  0\n  9 10  2  0  0  0  0\n 10  2  1  0  0  0  0\nM  END";

var DemoUtils = {
	kekuleAvailable: function()
	{
		return typeof(Kekule) !== 'undefined';
	},
	loadUrl: function(url, callback)
	{
		var req = new XMLHttpRequest();
		req.onreadystatechange = function ()
		{
			if (req.readyState != 4) return;
			if (req.status != 200 && req.status != 304)
			{
				callback(false, null);  // XHR failed
				throw 'HTTP error ' + req.status;
				return;
			}			
			callback(true, req.responseText || req.response);  // call successfule
		};

		req.open("GET", url);
		req.send();
	},
	loadFile: function(file, callback)
	{
		if (file)
		{
		  var reader = new FileReader();
		  reader.onload = function(e)
			{
				var content = reader.result;
				if (callback)
					callback(true, content);					
			};
		  reader.onerror = function()
			{
				console.error('Fail to load file: ', file.name);
				if (callback)
					callback(false);					
			}
		  reader.readAsText(file);
		}
	},
	assocFilePickerHandler: function(pickerElem, callback)
	{
		pickerElem.onchange = function()
		{
			DemoUtils.loadFile(pickerElem.files[0], callback);			
		}
	},
	assocFilePickerRelatedElems: function(pickerElem, relatedElems, callback)
	{
		pickerElem.onchange = function()
		{
			DemoUtils.loadFile(pickerElem.files[0], function(success, content){
				if (success)
				{
					if (relatedElems.contentDisplayer)
						relatedElems.contentDisplayer.value = content;
					if (relatedElems.molViewer)
						DemoUtils.loadMolDataInChemViewer(relatedElems.molViewer, content);					
				}
				if (callback)
					callback(success, content);
			});	
		}
	},
	initMolList: function(listElem, assocElems, srcMolDataList, mols)
    {
	  if (!srcMolDataList)
	    srcMolDataList = demoMolData;
      var elemList = listElem
      elemList.innerHTMl = '';
	  if (!mols)
	  {
		mols = Object.getOwnPropertyNames(srcMolDataList);
	  }
	  mols.unshift('(None)');
      for (var i = 0, l = mols.length; i < l; ++i)
      {
        var id = mols[i];
        var elemItem = document.createElement('option');
        elemItem.setAttribute('value', id);		
        var caption = id;
		elemItem.innerHTML = caption;        
        elemList.appendChild(elemItem);
      }
      
      var viewerElem = assocElems.viewer;
	  var textArea = assocElems.textArea;
	  
      elemList.onchange = function(e)
      {
        var id = elemList.value;
		var molData = id? srcMolDataList[id]: null;
		//if (molData)
		{
			if (textArea)
				textArea.value = molData || '';
			if (viewerElem)
			{
				DemoUtils.loadMolDataInChemViewer(viewerElem, molData);
			}
        }		
      };
    },
	loadMolDataInChemViewer: function(viewerElem, molData)
	{
		if (viewerElem && DemoUtils.kekuleAvailable())
		{
			var viewer = Kekule.Widget.getWidgetOnElem(viewerElem);
			var mol = molData? Kekule.IO.loadFormatData(molData, 'mol'): null;
			viewer.setChemObj(mol);
		}
	}
}

function $(id)
{
	return document.getElementById(id);
}